<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Srinidhi Vegetables</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f6f8; margin: 0; padding-bottom: 100px; }
        
        /* Navbar */
        header { background: white; padding: 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
        h1 { margin: 0; font-size: 24px; color: #2c3e50; font-weight: 800; letter-spacing: 0.5px; }

        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        
        /* Search Bar */
        input[type="text"] { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }

        /* Grid Layout */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }

        /* Card Style - FIXED SIZE FOR UNIFORMITY */
        .card { 
            background: white; border-radius: 12px; padding: 10px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.06); text-align: center;
            display: flex; flex-direction: column; justify-content: space-between; 
            height: 310px; /* Fixed height ensures alignment */
            position: relative;
            transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-3px); }

        /* Image Styling */
        .card img { 
            width: 100%; height: 140px; object-fit: cover; 
            border-radius: 8px; margin-bottom: 8px; 
            background-color: #f0f0f0; /* Fallback color */
        }
        
        /* TYPOGRAPHY - FIXED SIZES */
        .name { 
            font-size: 16px; font-weight: 700; color: #333;
            margin-bottom: 4px; height: 42px; overflow: hidden; 
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
            line-height: 1.3;
        }
        .unit { 
            font-size: 13px; color: #777; font-weight: 500; margin-bottom: 4px; 
        }
        .price { 
            color: #27ae60; font-size: 18px; font-weight: 800; margin-bottom: 10px; 
        }

        /* Add Button */
        .add-btn { 
            background: white; color: #27ae60; border: 2px solid #27ae60; 
            padding: 8px; width: 100%; border-radius: 6px; font-weight: 700; cursor: pointer;
            transition: 0.2s; font-size: 14px; text-transform: uppercase;
        }
        .add-btn:hover { background: #27ae60; color: white; }
        .add-btn:active { transform: scale(0.95); }
        
        /* Out of Stock Styling */
        .out-stock-card { opacity: 0.6; pointer-events: none; }
        .out-stock-card img { filter: grayscale(100%); }
        .badge { background: #e74c3c; color: white; padding: 4px 8px; font-size: 10px; border-radius: 4px; position: absolute; top: 10px; right: 10px; font-weight: bold; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .disabled-btn { background: #f3f3f3; color: #aaa; border: 1px solid #eee; cursor: not-allowed; padding: 8px; width: 100%; border-radius: 6px; font-weight: bold; font-size: 12px; }

        /* CART BAR (Floating Bottom) */
        .cart-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px;
            background-color: #27ae60; color: white;
            padding: 12px 20px; border-radius: 50px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 200; display: none; /* Hidden initially */
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { bottom: -50px; } to { bottom: 20px; } }

        .cart-info { font-size: 15px; font-weight: 500; }
        .cart-total { font-weight: 800; font-size: 18px; margin-left: 5px;}
        .whatsapp-btn {
            background: white; color: #27ae60; border: none;
            padding: 10px 20px; border-radius: 30px; font-weight: bold; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 5px;
        }
        .whatsapp-btn:hover { background-color: #f9f9f9; }
    </style>
</head>
<body>

    <header><h1>ü•¶ Srinidhi Vegetables</h1></header>

    <div class="container">
        <input type="text" id="search" placeholder="üîç Search vegetables..." onkeyup="renderShop()">
        <div id="grid" class="grid"></div>
    </div>

    <div id="cart-bar" class="cart-bar">
        <div class="cart-info">
            <span id="item-count">0</span> Items | ‚Çπ<span id="total-price" class="cart-total">0</span>
        </div>
        <button class="whatsapp-btn" onclick="sendOrder()">Order üöÄ</button>
    </div>

    <script>
        let products = [];
        let cart = {};

        async function loadData() {
            try {
                // 1. Fetch data from backend
                const res = await fetch('/api/vegetables');
                products = await res.json();
                renderShop();
            } catch (err) { console.error("Error loading data:", err); }
        }

        function renderShop() {
            const grid = document.getElementById('grid');
            const term = document.getElementById('search').value.toLowerCase();
            grid.innerHTML = "";

            products.forEach(item => {
                if(!item.name.toLowerCase().includes(term)) return;

                // Safe Image logic
                const safeImage = item.imageUrl || `https://placehold.co/400x300/e8f5e9/1b5e20.png?text=${item.name}`;

                grid.innerHTML += `
                    <div class="card ${!item.inStock ? 'out-stock-card' : ''}">
                        ${!item.inStock ? '<span class="badge">Sold Out</span>' : ''}
                        
                        <img src="${safeImage}" alt="${item.name}">

                        <div class="name">${item.name}</div>
                        <div class="unit">1 ${item.unit}</div>
                        <div class="price">‚Çπ${item.price}</div>
                        
                        ${item.inStock ? 
                          `<button class="add-btn" onclick="addToCart('${item.name}', ${item.price}, '${item.unit}')">ADD +</button>` :
                          `<button class="disabled-btn">Out of Stock</button>`
                        }
                    </div>
                `;
            });
        }

        // CART LOGIC
        function addToCart(name, price, unit) {
            if (!cart[name]) {
                cart[name] = { price: price, unit: unit, qty: 1 };
            } else {
                cart[name].qty++;
            }
            updateCartUI();
            if (navigator.vibrate) navigator.vibrate(50); // Little vibration on mobile
        }

        function updateCartUI() {
            let totalItems = 0;
            let totalPrice = 0;
            
            for(let item in cart) {
                totalItems += cart[item].qty;
                totalPrice += cart[item].qty * cart[item].price;
            }

            document.getElementById('item-count').innerText = totalItems;
            document.getElementById('total-price').innerText = totalPrice;

            const cartBar = document.getElementById('cart-bar');
            if (totalItems > 0) {
                cartBar.style.display = "flex";
            } else {
                cartBar.style.display = "none";
            }
        }

        function sendOrder() {
            let message = "Hello Srinidhi Vegetables! ü•¶\nI would like to place an order:\n\n";
            let total = 0;
            
            for (let name in cart) {
                let item = cart[name];
                let lineTotal = item.qty * item.price;
                message += `‚ñ™Ô∏è ${name} (${item.qty} ${item.unit}) - ‚Çπ${lineTotal}\n`;
                total += lineTotal;
            }
            
            message += `\n*Total Bill: ‚Çπ${total}*`;
            message += `\n\nPlease confirm my order.`;
            
            // üî• YOUR NUMBER: 9963169733 (with Country Code 91)
            const phoneNumber = "919963169733"; 
            
            const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        loadData();
    </script>
</body>
</html>